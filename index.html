<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>React Menu App</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="./css/all.min.css">
</head>
<body>
  <div id="container"></div>
  
  <script type="text/babel">
    'use strict';

    {
      const Menu = (props) => {
        
        const toggle = (e) => {
          const dts = document.querySelectorAll('dt');
          e.target.parentNode.classList.toggle('appear');

          // dts.forEach(el => {
          //   if (e.target.id !== el.id) {
          //     el.parentNode.classList.remove('appear');
          //   }
          // });
        }

        return (
          <li>
            <p>{props.day}日目</p>
            <p>　朝： {props.bMenu}</p>
            <p>　昼： {props.lMenu}</p>
            <p>　夕： {props.dMenu}</p>
            <div className="ingredients">
              <dt onClick={toggle} id={props.day}>
                ＜材料＞-----------------------------
                <i className="fa-solid fa-plus"></i>
              </dt>
              <dd>{props.ingredients}</dd>
            </div>
          </li>
        );
      };

      const RankedDish = (props) => {

        return (
          <li>
            {props.ranking}位 {props.title} （→{props.dishName}）
          </li>
        );
      };

      const App = () => {
        const menus = [
          {id: 'K001', type: 1, menu: 'ご飯、納豆、味噌汁'},
          {id: 'K002', type: 1, menu: 'わかめご飯、味噌汁'},
          {id: 'K003', type: 1, menu: 'フレンチトースト、ソーセージ、コンソメスープ'},
          {id: 'K004', type: 1, menu: 'トースト、ハムエッグ、コンソメスープ、サラダ'},
          {id: 'K005', type: 1, menu: 'ご飯、焼鮭、味噌汁'},
          {id: 'K006', type: 2, menu: '蕎麦、天ぷら'},
          {id: 'K007', type: 2, menu: '肉うどん'},
          {id: 'K008', type: 2, menu: '焼きそば、中華スープ'},
          {id: 'K009', type: 2, menu: 'ご飯、酢豚、中華スープ'},
          {id: 'K010', type: 2, menu: 'ご飯、野菜炒め、中華スープ'},
          {id: 'K011', type: 2, menu: 'オムライス、サラダ'},
          {id: 'K012', type: 2, menu: 'お好み焼き'},
          {id: 'K013', type: 2, menu: 'たこ焼き'},
          {id: 'K014', type: 2, menu: '明太スパゲッティ、サラダ'},
          {id: 'K015', type: 3, menu: 'カレーライス'},
          {id: 'K016', type: 3, menu: 'ご飯、焼き魚、豚汁'},
          {id: 'K017', type: 3, menu: 'ご飯、唐揚げ、サラダ'},
          {id: 'K018', type: 3, menu: 'ご飯、コロッケ、サラダ'},
          {id: 'K019', type: 3, menu: 'ご飯、ハンバーグ、サラダ'},
          {id: 'K020', type: 3, menu: 'ご飯、麻婆豆腐、中華スープ'},
          {id: 'K021', type: 3, menu: 'ご飯、豚の角煮、味噌汁'},
          {id: 'K022', type: 3, menu: 'ご飯、すき焼き'},
        ];

        const dishes = [
          {name: '味噌汁', ingredient: '豆腐、わかめ、味噌、だし'},
          {name: 'わかめご飯', ingredient: 'わかめ、ご飯'},
          {name: 'フレンチトースト', ingredient: '卵、トースト'},
          {name: 'コンソメスープ', ingredient: '玉ねぎ、ニンジン、コーン、コンソメ'},
          {name: '天ぷら', ingredient: '天ぷら粉、レンコン、カボチャ、ブロッコリー、オクラ'},
          {name: 'ハムエッグ', ingredient: '卵、ハム'},
          {name: '野菜炒め', ingredient: 'キャベツ、ニンジン、もやし、創味シャンタン'},
          {name: '中華スープ', ingredient: 'わかめ、春雨、白ゴマ、創味シャンタン'},
          {name: '酢豚', ingredient: '豚肉、ニンジン、ピーマン、玉ねぎ'},
          {name: 'オムライス', ingredient: 'ご飯、卵、ケチャップ'},
          {name: 'サラダ', ingredient: 'レタス、トマト'},
          {name: 'カレーライス', ingredient: 'カレールー、鶏もも肉、玉ねぎ、ニンジン、ジャガイモ、福神漬け'},
          {name: '肉うどん', ingredient: '牛肉、うどん'},
        ];

        const ranking = [
          {ranking: '1', title: '簡単！やみつきレモンねぎ塩チキン', dishName: 'レモンねぎ塩チキン'},
          {ranking: '2', title: '簡単ふわとろ！親子丼', dishName: '親子丼'},
          {ranking: '3', title: '大根ときゅうりの三色ナムル', dishName: '大根ときゅうりの三色ナムル'},
          {ranking: '4', title: 'レンジでしっとり簡単よだれ鶏', dishName: 'よだれ鶏'},
          {ranking: '5', title: 'さっぱり おかかぽん酢でナスの焼き浸し', dishName: 'ナスの焼き浸し'},
          {ranking: '6', title: 'ごはんがすすむ！チキンとキャベツのガーリック炒め', dishName: 'チキンとキャベツのガーリック炒め'},
          {ranking: '7', title: 'ボリューム抜群 キャベツの豚肉巻きレンジ蒸し', dishName: 'キャベツの豚肉巻き'},
          {ranking: '8', title: 'ご飯が進む！豚肉の生姜焼き', dishName: '豚肉の生姜焼き'},
          {ranking: '9', title: '豚バラ肉のスタミナニラ玉炒め', dishName: 'ニラ玉炒め'},
          {ranking: '10', title: 'すぐできる！もやし中華サラダ', dishName: 'もやし中華サラダ'},
          {ranking: '11', title: 'お箸が止まらないおいしさ 無限ナス', dishName: '無限ナス'},
          {ranking: '12', title: 'チーズたっぷり！ピーマンの肉巻き', dishName: 'ピーマンの肉巻き'},
          {ranking: '13', title: '本場の味ゴーヤチャンプル', dishName: 'ゴーヤチャンプル'},
          {ranking: '14', title: 'もう箸が止まらない 無限ゴーヤ', dishName: '無限ゴーヤ'},
          {ranking: '15', title: '我が家の定番！ピーマンとなすの味噌炒め', dishName: 'ピーマンとなすの味噌炒め'},
          {ranking: '16', title: '基本のかぼちゃの煮物', dishName: 'かぼちゃの煮物'},
          {ranking: '17', title: 'ズッキーニのジョン', dishName: '-'},
          {ranking: '18', title: '豚バラと大根のスタミナみそ炒め', dishName: '-'},
          {ranking: '19', title: '玉ねぎと豚こま切れ肉の生姜焼き', dishName: '-'},
          {ranking: '20', title: '簡単 豚バラもやしのスタミナすき焼き', dishName: 'すき焼き'},
          {ranking: '21', title: 'トマトときゅうりの中華風ツナサラダ', dishName: '中華風ツナサラダ'},
          {ranking: '22', title: 'サッパリおいしい！鶏むね肉の甘辛みぞれ煮', dishName: '鶏むね肉の甘辛みぞれ煮'},
          {ranking: '23', title: 'たっぷりナスとひき肉の ごちそう丼', dishName: '-'},
          {ranking: '24', title: '鶏肉とズッキーニの甘酢炒め', dishName: '-'},
          {ranking: '25', title: '照り焼きチキン', dishName: '照り焼きチキン'},
          {ranking: '26', title: '【村田シェフ】唐揚げ', dishName: '唐揚げ'},
          {ranking: '27', title: '豚こま肉とナスとしめじのオイスター炒め', dishName: '豚こま肉とナスとしめじのオイスター炒め'},
          {ranking: '28', title: 'パン粉いらずで簡単＆ジュワっと！ピーマンの肉詰め', dishName: 'ピーマンの肉詰め'},
          {ranking: '29', title: '柔らか鶏胸肉で！揚げないおろしポン酢チキン', dishName: '-'},
          {ranking: '30', title: 'とまらない美味しさ にんじんしりしり', dishName: 'にんじんしりしり'},
          {ranking: '31', title: '即席 きゅうりの塩昆布おかか和え', dishName: 'きゅうりの塩昆布おかか和え'},
          {ranking: '32', title: 'ごま油香る 叩ききゅうりと鶏ササミの簡単和え', dishName: '-'},
          {ranking: '33', title: 'ふんわり柔らかい 豆腐ハンバーグ', dishName: '豆腐ハンバーグ'},
          {ranking: '34', title: '卵とわかめの春雨スープ', dishName: '卵とわかめの春雨スープ'},
          {ranking: '35', title: '簡単 デミグラスソースのハンバーグ', dishName: 'ハンバーグ'},
          {ranking: '36', title: 'やみつき ヤンニョムチキン', dishName: 'ヤンニョムチキン'},
          {ranking: '37', title: '牛肉とピーマンのスタミナねぎ塩炒め', dishName: 'スタミナねぎ塩炒め'},
          {ranking: '38', title: '基本の肉じゃが', dishName: '肉じゃが'},
          {ranking: '39', title: '簡単副菜 じゃがいもとピーマンのごま和え', dishName: 'じゃがいもとピーマンのごま和え'},
          {ranking: '40', title: 'たっぷりピーマンと ぷりぷりしらたきの甘辛炒め', dishName: '-'},
          {ranking: '41', title: 'トマトとズッキーニの簡単イタリアン炒め', dishName: '-'},
          {ranking: '42', title: 'めんつゆで簡単 ナスの煮浸し', dishName: 'ナスの煮浸し'},
          {ranking: '43', title: '簡単 もやしときゅうりのツナナムル', dishName: 'もやしときゅうりのツナナムル'},
          {ranking: '44', title: '旨みたっぷり つゆだく牛丼', dishName: '牛丼'},
          {ranking: '45', title: '焼肉のタレで簡単ピーマンとナスのそぼろ炒め', dishName: 'ピーマンとナスのそぼろ炒め'},
          {ranking: '46', title: 'とっても簡単！卵とトマトの中華風炒め', dishName: '卵とトマトの中華風炒め'},
          {ranking: '47', title: 'ナスと豚肉の味噌炒め', dishName: 'ナスと豚肉の味噌炒め'},
          {ranking: '48', title: 'こんなに簡単！茄子とひき肉のボロネーゼ風パスタ', dishName: '茄子とひき肉のボロネーゼ風パスタ'},
          {ranking: '49', title: '超簡単！もやしナムル', dishName: 'もやしナムル'},
          {ranking: '50', title: 'めんつゆで簡単 麻婆茄子', dishName: '麻婆茄子'},
        ];

        const chosenMenus = [];

        // 献立を作成する日数
        // const days = 3;
        const days = 5;

        let allIngredients = [];

        // 献立を作成する日数分だけ繰り返す
        for (let i = 1; i <= days; i++) {

          // 献立を作成する
          const bMenus = menus.filter((menu) => { return menu.type === 1; }); // 朝食
          const lMenus = menus.filter((menu) => { return menu.type === 2; }); // 昼食
          const dMenus = menus.filter((menu) => { return menu.type === 3; }); // 夕食

          let getBMenu = bMenus[Math.floor(Math.random() * bMenus.length)];
          let getLMenu = lMenus[Math.floor(Math.random() * lMenus.length)];
          let getDMenu = dMenus[Math.floor(Math.random() * dMenus.length)];

          const ingredients = [];
          const chosenDishes = [...getBMenu.menu.split('、'), ...getLMenu.menu.split('、'), ...getDMenu.menu.split('、')];

          // 重複を削除
          const chosenDishes2 = Array.from(new Set(chosenDishes));

          for (const dishName of chosenDishes2) {
            for (const dish of dishes) {
              if (dish.name === dishName) {
                ingredients.push(dish.name + '：' + dish.ingredient);
                allIngredients = [...allIngredients, ...dish.ingredient.split('、')];
              }
            }
          }

          // 暫定対応
          const ingredients2 = ingredients.map((mate, index) => 
            <p key={index} className="ingredientsItem">　{mate}</p>
          );

          const obj = {
            id: i, day: i,
            bMenu: getBMenu.menu,
            lMenu: getLMenu.menu,
            dMenu: getDMenu.menu,
            ingredients: ingredients2,
          };
          chosenMenus.push(obj);
        }

        // 全食材の重複を削除
        const allIngredients2 = Array.from(new Set(allIngredients));

        // 暫定対応(必要な食材)
        const allIngredients3 = allIngredients2.map((item, index) => 
          <div key={index}>
            <input type="checkbox" id={index} />
            <label htmlFor={index}>{item}</label>
          </div>
        );

        const menuItems = chosenMenus.map((menu) => {
          return (
            <Menu 
              key={menu.id}
              menuId={menu.id}
              day={menu.day}
              bMenu={menu.bMenu}
              lMenu={menu.lMenu}
              dMenu={menu.dMenu}
              ingredients={menu.ingredients}
            />
          );
        });

        const rankingItems = ranking.map((rankingItem) => {
          return (
            <RankedDish 
              key={rankingItem.ranking}
              ranking={rankingItem.ranking}
              title={rankingItem.title}
              dishName={rankingItem.dishName}
            />
          );
        });
        
        const open = () => {
          const modal = document.getElementById('modal');
          const mask = document.getElementById('mask');
          modal.classList.remove('hidden');
          mask.classList.remove('hidden');
        }

        const close = () => {
          const modal = document.getElementById('modal');
          const mask = document.getElementById('mask');
          modal.classList.add('hidden');
          mask.classList.add('hidden');
        }

        return (
          <>
            <section id="modal" className="hidden">
              <p>買い物リスト</p>
              {allIngredients3}
              <div id="close" onClick={close}>
                閉じる
              </div>
            </section>
            <h1>献立</h1>
            <div className="iconBox">
              <i className="fa-solid fa-cart-shopping" onClick={open}></i>
              {/* 
                コメントアウトしてみた
                <i className="fa-solid fa-gear"></i>
              */}
              <i className="fa-solid fa-arrow-rotate-right" onClick={() => window.location.reload()}></i>
            </div>
            <ul className="menus">
              {menuItems}
            </ul>
            
            <br />
            <p>参考情報-----------------------------</p>
            <ul className="ranking">
              {rankingItems}
            </ul>
            
            <div id="mask" className="hidden" onClick={close}></div>
          </>
        );
      };

      const container = document.querySelector('#container');
      const root = ReactDOM.createRoot(container);
      root.render(<App />);
    }
  </script>
</body>
</html>